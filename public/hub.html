<!doctype html>
<html>

<head>
    <title>Socratik</title>
    <link rel="stylesheet" href="css/main.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ"
        crossorigin="anonymous">
</head>

<body class="fullheight">
    <nav class="navbar navbar-toggleable-md navbar-light bg-faded">
            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <a class="navbar-brand" href="#">Socratik</a>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <a href="#">Home</a>
                    </li>
                    &nbsp;&nbsp;&nbsp;
                    <li class="nav-item">
                        <a href="about.html">About</a>
                    </li>
                    &nbsp;&nbsp;&nbsp;
                    <li class="nav-item">
                        <a href="groups.html">My Groups</a>
                    </li>
                </ul>
            </div>
        </nav>
        
    <div class="fullheight">
        <div class="row fullheight">
            <!--Sidebar-->
            <div class="col-md-3 fullheight">
                <div class="card fullheight" style="margin: 10px; height:90%;">
<br>
<table id="questions">
    <tbody id="qbody">
        <tr class="qrow">
            <td class="text-center">
                <h2 class="questiontitle" href="#">Questions</h2>

            </td>
            <td><button class="btn btn-default" id="newquestion">+</button></td>
        </tr>
        <tr class="qrow">
            <td><a class="question" href="#">Was Huckleberry Finn a real book?</a></td>
        </tr>
        <tr class="qrow">
            <td><a class="question" href="#">Was Huckleberry Finn a real book?</a></td>
        </tr>
        <tr class="qrow">
            <td><a class="question" href="#">Was Huckleberry Finn a real book?</a></td>
        </tr>
        <tr class="qrow">
            <td><a class="question" href="#">Was Huckleberry Finn a real book?</a></td>
        </tr>
        <tr class="qrow">
            <td><a class="question" href="#">Was Huckleberry Finn a real book?</a></td>
        </tr>
    </tbody>
</table>
</div>
</div>
<!--Main Page-->
<div class="col-md-9 col-md-offset-1" id="scrollingpanel" style="padding: 10px 30px 0px 0px">
<div class="card" style="width:100%">
<div class="row" style="height:80px; padding-left: 10px;">
<!--                        Online users-->
<div class="user">
    <img src="/css/personIcon.png">
    <p>Jim bob</p>
</div>
<div class="user" style="margin: 0px 5px;">
<img src="/css/personIcon.png">
<p>John Smith</p>
</div>
<div class="user" style="margin: 0px 5px;">
<img src="/css/personIcon.png">
<p>Your Boi</p>
</div>

</div>
</div>
<br>
<div class="card" style="padding:9px;">
<div class="row">
    <div class="col-md-12">
        <h1 id="questionstatement">Was Huckleberry Finn a real book?</h1>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <p id="qbody" class="questionbody">So I was reading this assignment I got in English, and I thought to myself, "This name is so ridiculous, how could
            a book called 'Huckleberry Finn' even exist in the first place?" Can anyone help me find some record of it on
            the internet or something so I know that I'm not going completely crazy?</p>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <p id="qdetails" class="details">Posted by Test Testson at 22:53 on Saturday, January 14</p>
    </div>
</div>
<div class="row fullheight">
    <table id="answertable">
        <tbody>
            <tr class="arow">
                <td>
                    <div class="row">
                        <div class="col-md-12">
                            <p class="answer">I think you're right! I tried to do some research, yet except on our homework assignments, I
                                found nothing on the entire internet about any such book. It must be a conspiracy!</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <p class="answerdetails">Posted by Bob Bobson at 23:00 on Saturday, January 14</p>
                        </div>
                    </div>
                </td>
            </tr>
            <tr class="arow">
                <td>
                    <div class="row">
                        <div class="col-md-12">
                            <p class="answer">I think you're right! I tried to do some research, yet except on our homework assignments, I
                                found nothing on the entire internet about any such book. It must be a conspiracy!</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <p class="answerdetails">Posted by Bob Bobson at 23:00 on Saturday, January 14</p>
                        </div>
                    </div>
                </td>
            </tr>
            <tr class="arow">
                <td>
                    <div class="row">
                        <div class="col-md-12">
                            <p class="answer">I think you're right! I tried to do some research, yet except on our homework assignments, I
                                found nothing on the entire internet about any such book. It must be a conspiracy!</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <p class="answerdetails">Posted by Bob Bobson at 23:00 on Saturday, January 14</p>
                        </div>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>

</div>
</div>
<div id="dialog">
    <textarea id="comment" rows="2" type="text" class="form-control" placeholder="Comment"></textarea>
</div>
</div>
</div>
<br>
<img src="/css/personIcon.png" style="width:75px; height:75px; padding: 8px">
<img src="/css/personIcon.png" style="width:75px; height:75px; padding: 8px">
<img src="/css/personIcon.png" style="width:75px; height:75px; padding: 8px">
<br><br>
<div class="col-md-9 white" style="height:90vh;">

</div>
</body>

<style>
.mainbg {
    background-color: rgb(240, 240, 240);
}
.activeusers {
    height: 100px;
    border: 1px solid black;
}
.answer {
    padding: 1em;
    padding-bottom: 0;
}
.answerdetails {
    padding-left: 1em;
    color: grey;
}
.arow {
    border-bottom: 1px solid gray;
}
h1, h2, h3 {
    font-family: Helvetica;
    font-weight: 200;
}
.questionbody {
    font-size: 1.4em;
}
.details {
    color: rgb(113, 113, 113);
}
.qrow {
    width: 100%;
    margin-bottom: 1em;
    height: 50px;
    border-bottom: 1px solid #ccc;
}

.qrow td {
    padding-left: 15px;
}

.question {
    width: 100%;
}
#questions {
    width: 100%;
}
.fullheight {
    height: 100%;
}
.container {
    margin-left: 0;
    margin-right: 0;
}
html, body {
    height: 100%;
}
.sidebar {
    background-color: rgba(255, 255, 255, 0.95);
}
.mainbg {
    background-color: lightblue;
    margin-right: 0;
}
#answers {
    background-color: white;
}

#dialog {
    width: 70%;
    margin-left:27%;
    padding: 10px;
    position: fixed;
/*    height: 100px;*/
    background-color: #ccc;
    box-shadow: 0px 0px 5px #888888;
    bottom: 0px;
}
</style>

<script src="/socket.io/socket.io.js"></script>
<script>
    var groupId;
    var questionId;
    var questions;

    var url = window.location.href;

    var splitURL = url.slice(url.indexOf("?")).split('&');
    if (splitURL.length >= 1) {
        groupId = splitURL[0].split('=')[1];

        if (splitURL.length >= 2) {
            questionId = splitURL[1].split('=')[1];
        } else {
            questionId = null;
        }

    } else {//Display first question in group
        //window.location.replace('/groups.html');
    }
    
    $(document).ready(function () {//call page with 
        $.get("/api/v1/account/loggedin", function (data, status) {
            if (!data.success) {
                window.location.replace("index.html");
            }
        });



        clearQuestions();
        getQuestions();

        $.post("/api/v1/group/" + groupId + "/questions", {}, function(data, status) {
            for (var i = 0; i < data.questions.length; ++i) {
                if (questionId === null) {
                    questionId = data.quesitons[0]._id;
                }
                if (data.questions._id == questionId) {
                    clearComments();
                    setQuestion(data.questions[i]);
                    for (var j = 0; j < data.questions[i].comments.length; ++j) {
                        addComment(data.questions[i].comments[j]);
                    }
                    break;
                }
            }
        });

    });

    function clearQuestions() {
        var header = `
        <tr class="qrow">
                                <td class="text-center">
                                    <h2 class="questiontitle" href="#">Questions</h2>
                                    
                                </td>
                                <td><button class="btn btn-primary" id="newquestion">+</button></td>
                            </tr>`;
        $('#qbody').html(header);

        $('#newquestion').click(function (e) {
            e.preventDefault();
            window.location.replace("/createquestion.html?groupId=" + groupId);
        });
    }

    function getQuestions() {//get and render questions
        $.post("/api/v1/group/" + groupId + "/questions", function (data, status) {
            for (var i = 0; i < data.questions.length; ++i) {
                addQuestion(data.questions[i]);
            }
        });
    }

    function addQuestion(q) {
        var question = `<tr class="qrow">
            <td><a class="question" href="hub.html?groupId=GROUPID&questionId=QID">QUESTION</a></td>
        </tr>`;

        question = question.replace("GROUPID", groupId).replace("QUESTION", q.question).replace("QID", q._id);
        $('#qbody').append(question);
    }

    function clearComments() {
        $('#answertable').html("");
    }

    function setQuestion(q) {
        $('#questionstatement').text(q.question);
        $('#qbody').text(q.desc);
        $('#qdetails').text('Posted by Bob Bobson at 23:00 on Saturday, January 14');
        for (var i = 0; i < q.comments.length; ++i) {
            addComment(q.comments[i]);
        }
    }

    function addComment(c) {
        var comment = `
        <tr class="arow">
                <td>
                    <div class="row">
                        <div class="col-md-12">
                            <p class="answer">ANSWERBODY</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <p class="answerdetails">Posted by FIRSTNAME LASTNAME at TIMEOFDAY on DATE</p>
                        </div>
                    </div>
                </td>
            </tr>`;
        comment = comment.replace("ANSWERBODY", c.comment);
        comment = comment.replace("FIRSTNAME", c.firstname);
        comment = comment.replace("LASTNAME", c.lastname);
        var time = new Date(c.date);
        var timeofday = time.getHours() + ":" + time.getMinutes;
        var date = time.getDay() + ', ' + time.getMonth() + ' ' + time.getUTCDate() + ', ' + time.getFullYear();
        comment = comment.replace("TIMEOFDAY", timeofday);
        comment = comment.replace("DATE", date);
        $('#answertable').first().append(comment);
    }


    var socket = io();

    //You are not logged in
    socket.on('logout', function() {
    	window.location.replace('/index.html');
    });
    
    socket.on('init', function() {
    	socket.emit('mygroup', groupId);
    });
    
    socket.on('message', function(data) {
        console.log('message received');
    	addComment({
            comment: data.message,
            date: data.date,
            firstname: 'test',
            lastname: 'test'
        });
    });


    $('textarea').keyup(function(e){
        if(e.keyCode == 13) { //enter key pressed
            var comment =  $('#comment').val();
            $('#comment').val('');
//            socket.emit('chat message', comment, groupId);
            addComment({
            comment: comment,
            date: Date.now(),
            firstName: 'test',
            lastname: 'test'
        });
        }
    });
</script>

</html>